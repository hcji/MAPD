---
title: "Wavelet-based Peak Detection Assisted by Mass"
author: "Hongchao Ji"
date: "2017/11/2"
output:
  html_document:
    df_print: paged
  pdf_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Abstract

WMPD is a peak detection method, which combines wavelet transform and mass spectrometry information. The main purpose is to identify whether overlapped peaks exist and whether they are true positive. If the overlapped peaks are true peaks, WMPD can also resolve them and calculate their peak heights, widths and areas respectively.

The input of WMPD should be a **pure ion chromatogram**, which can be obtained by any method (e.g. TracMass, PITracer or KPIC2). In a pure ion chromatogram, only one point is included each scan. An example is included in the **inst** folder of this package.

## Usage

Only one function need to be used in the command line in R, which is **runWMPD()**. After this, a GUI based on shiny will be launched.

```
library(WMPD)
runWMPD()
```
Once you upload the .csv file, the elution profile and the distribution of the m/z values will be shown like this: 
```{r step1, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
library(WMPD)
library(plotly)
pic <- read.csv(system.file('example_pic.csv', package = 'WMPD'))
plot_ly(x=pic[,1], y=pic[,2], type = 'scatter', mode = 'lines', color = 'blue', showlegend= FALSE) %>%
  layout(xaxis = list(tick0 = 0, title = 'Retention Time (s)'),
         yaxis = list(title = 'Intensity'))
plot_ly(x=pic[,1], y=pic[,3], color = pic[,2], type = 'scatter')%>%
        layout(xaxis = list(tick0 = 0, title = 'Retention Time (s)'),
               yaxis = list(title = 'M/Z'))
```
Then, you need to input the parameters of the peak detection, and click the **Go** button. After seconds, the final result will be shown bellow like this: 
```{r step2, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
library(WMPD)
library(plotly)
pic <- read.csv(system.file('example_pic.csv', package = 'WMPD'))
Peaks <- WMPD(pic, 4, 0, 0.05, 100)
fit.pics <- do.call(rbind, Peaks$fitpics)
sum.vec <- colSums(fit.pics)
p <- plot_ly(x=pic[,1], y=pic[,2], type = 'scatter', mode = 'lines', name = 'raw', showlegend= TRUE) %>%
          layout(xaxis = list(tick0 = 0, title = 'Retention Time (s)'),
                 yaxis = list(title = 'Intensity'))
for (f in 1:length(Peaks$fitpics)) {
  p <- add_trace(p, x = pic[,1], y = Peaks$fitpics[[f]], line = list(dash = 'dash'), mode='line', name = paste('peak',f))
}
p <- add_trace(p, x = pic[,1], y = sum.vec, mode='line', name = 'fitted profile')
p
```

## Enjoy !
